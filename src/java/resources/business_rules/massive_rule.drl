dialect "mvel"

import com.flowserve.system606.model.PerformanceObligation;
import com.flowserve.system606.model.InputTypeName;
import com.flowserve.system606.model.OutputTypeName;
import java.util.logging.Logger;

global Logger logger;

rule "Calculate EAC Change"

    // Needed only to support tab-out ajax requests on the UI.
    when
        // Pull input values needed for this calculation.
        pob : PerformanceObligation(
            estimatedCostAtCompletion : getCurrencyInput(InputTypeName.ESTIMATED_COST_AT_COMPLETION) != null,
            estimatedCostAtCompletionPriorPeriod : getCurrencyInputPriorPeriod(InputTypeName.ESTIMATED_COST_AT_COMPLETION) != null
        )
    then
        changeInEstimate = estimatedCostAtCompletionPriorPeriod - estimatedCostAtCompletion;
        pob.putCurrencyOutput(OutputTypeName.CHANGE_IN_ESTIMATED_COST_AT_COMPLETION, changeInEstimate);
end

rule "Calculate Estimated Gross Profit and Margin"

    // Needed only to support tab-out ajax requests on the UI.
    when
        // Pull input values needed for this calculation.
        pob : PerformanceObligation(
            transactionPrice : getCurrencyInput(InputTypeName.TRANSACTION_PRICE) != null,
            estimatedCostAtCompletion : getCurrencyInput(InputTypeName.ESTIMATED_COST_AT_COMPLETION) != null
        )
    then
        // Calculate all outputs possible using these inputs.

        estimatedGrossProfit =  transactionPrice - estimatedCostAtCompletion;
        pob.putCurrencyOutput(OutputTypeName.ESTIMATED_GROSS_PROFIT, estimatedGrossProfit);
        estimatedGrossMargin = estimatedGrossProfit / transactionPrice
        pob.putCurrencyOutput(OutputTypeName.ESTIMATED_GROSS_MARGIN, estimatedGrossMargin);
end
